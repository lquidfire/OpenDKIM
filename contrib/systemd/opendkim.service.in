# If you are using OpenDKIM with SQL datasets it might be necessary to start OpenDKIM after the database servers.
# For example, if using both MariaDB and PostgreSQL, change "After=" in the "[Unit]" section to:
# After=network.target nss-lookup.target syslog.target mariadb.service postgresql.service

[Unit]
Description=DomainKeys Identified Mail (DKIM) Milter
Documentation=man:opendkim(8) man:opendkim.conf(5) man:opendkim-genkey(8) man:opendkim-genzone(8) man:opendkim-keygen(1) man:opendkim-testadsp(8) man:opendkim-testkey http://www.opendkim.org/docs.html
After=network.target nss-lookup.target syslog.target

[Service]
Type=forking
User=opendkim
Group=opendkim
PIDFile=@localstatedir@/run/opendkim/opendkim.pid
EnvironmentFile=-@sysconfdir@/sysconfig/opendkim
ExecStart=@sbindir@/opendkim $OPTIONS
ExecReload=/bin/kill -USR1 $MAINPID

# Modern systemd path management
StateDirectory=opendkim
StateDirectoryMode=0750

# Basic security improvements
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
PrivateTmp=true
RestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX

# Restart behavior
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target

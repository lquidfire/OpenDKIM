Description: opendkim-genzone: Fix inverted logic in subdomains switch (-s)
 After a patch by Andreas Schulze that was only partially applied upstream.
Author: David BÃ¼rgin <dbuergin@gluet.ch>
Origin: other, https://github.com/trusteddomainproject/OpenDKIM/commit/ce640c310b88cbd35b2bc21a41e8e652319707dc
Bug: https://github.com/trusteddomainproject/OpenDKIM/pull/64

--- a/opendkim/opendkim-genzone.c
+++ b/opendkim/opendkim-genzone.c
@@ -660,29 +660,28 @@
 			break;
 		}
 
-		if (subdomains) {
+		if (subdomains && strcasecmp(domain, onlydomain) != 0)
+		{
 			domain_len = strlen(domain);
 			onlydomain_len = strlen(onlydomain);
 
-			if ((domain_len == onlydomain_len &&
-			     strcasecmp(domain, onlydomain) == 0) ||
-			    (domain_len > onlydomain_len &&
-			     domain[domain_len - onlydomain_len - 1] == '.' &&
-			     strcasecmp(domain + domain_len - onlydomain_len,
-			                onlydomain) == 0)) {
+			if (!(domain_len > onlydomain_len &&
+			      domain[domain_len - onlydomain_len - 1] == '.' &&
+			      strcasecmp(domain + domain_len - onlydomain_len,
+			                 onlydomain) == 0))
+			{
 				fprintf(stderr, "%s: record %d for '%s' skipped\n",
 					progname, c, keyname);
 				continue;
 			}
-		} else {
-			if (onlydomain != NULL &&
-			    strcasecmp(domain, onlydomain) != 0)
-			{
-				fprintf(stderr, "%s: record %d for '%s' skipped\n",
-				        progname, c, keyname);
+		}
+		else if (onlydomain != NULL &&
+			 strcasecmp(domain, onlydomain) != 0)
+		{
+			fprintf(stderr, "%s: record %d for '%s' skipped\n",
+			        progname, c, keyname);
 
-				continue;
-			}
+			continue;
 		}
 
 		if (verbose > 1)
